<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Login</title>
    <link rel="stylesheet" href="stylesheet.css">
    

</head>

<body>
    <div class="container">
        <h2>Provider Login</h2>
        <form id="loginForm">
            <input type="text" id="username" placeholder="Username" value="dataload" required /><br />
            <input type="password" id="password" placeholder="Password" value="dataload" required /><br />
            <button type="submit" class="login-btn">Login</button>
            <div id="statusMessage" class="status-message"></div>
        </form>

        <button id="forgotPasswordBtn">Forgot Password</button>

    </div>

        <script>

    const loginUrl = "https://tablettest.mymps.co.za/tablet/mps-api/api/v1/authentication/account/login";

    document.getElementById("loginForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();
        const statusMessage = document.getElementById("statusMessage");

        if (!username || !password) {
            statusMessage.textContent = " ‚ö†Ô∏è Please enter both username and password.";
            return;
        }

        statusMessage.textContent = "üîÑ Logging in...";

        const payload = new URLSearchParams();
        payload.append("grant_type", "password");
        payload.append("username", username);
        payload.append("password", password);
        payload.append("client_id", "178dccca-a27b-49d8-49d8-81ee-ff670ccdc64a");

        try {
            const response = await fetch(loginUrl, {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: payload
            });

            const data = await response.json();
            console.log("Login response:", data);

            if (!response.ok || !data.access_token) {
                statusMessage.textContent = "‚ùå Invalid username or password.";
                return;
            }

            localStorage.setItem("access_token", data.access_token);
            localStorage.setItem("token_type", data.token_type || "Bearer");

            statusMessage.textContent = "‚úÖ Login successful. Redirecting...";
            setTimeout(() => {
                window.location.href = "patient.html";
            }, 1000);

        } catch (error) {
            console.error("Login Error:", error);
            statusMessage.textContent = `‚ùå Network or server error: ${error.message}`;
        }
        });

        document.getElementById("forgotPasswordBtn").addEventListener("click", function() {
            const email = prompt("Please enter your email address to reset your password:");

            if (email) {
                // TODO: Send an email to backend API for reset link
                alert("A password reset link has been sent to: " + email);
            }
    });
</script>
</body>
</html>
